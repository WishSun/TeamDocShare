# 客户端流程设计  
![](https://i.imgur.com/Im26wQe.png)
## 注解:  
1. **解析出服务器端IP地址和端口**    
   调用配置文件解析模块解析出IP地址和端口  

2. **创建socket，连接服务器**  
   创建客户端套接字，连接上一步解析出的IP地址和端口  

3. **打印登录或注册选择界面**  
   连接服务端成功之后，即打印登录或注册选择界面供用户选择(通过编号)  

4. **用户选择登录还是注册**   
   如果用户选择的是登录，则转步骤5; 如果用户选择的是注册，则转步骤6  
  
5. **获取用户名密码，进行服务端认证**   
   首先从标准输入获取用户的用户名和密码信息，将其构建成一个协议包，将请求类型设置为登录，然后发送给服务端进行验证  
	- 验证成功，转步骤9  
	- 验证失败，转步骤4  

6. **获取新用户信息，提交给服务端进行注册**   
   首先从标准输入获取用户的用户名、密码(新用户不指定组ID)，将其构建成一个协议包，将请求类型设置为注册，然后发送给服务端进行注册  
	- 注册成功，转步骤9  
	- 注册失败，转步骤4  

9. **创建共享目录和本地下载目录**    
   每个登录用户都有一个共享目录，放入该目录的文件将被认为是用户想要共享出去的文件，也都有一个本地下载目录，所有用户从服务端拉取到的文件都会被放入该目录下，这两个目录的目录名分别是是登录用户名+.share和登录用户名+.download, 例如用户名为WishSun，则共享目录名为WishSun.share,本地下载目录为WishSun.download。首先会查看这两个目录是否存在  
	- 如果不存在，则创建  
	- 如果存在，什么都不做  

10. **开启浏览目录线程**  
   客户端有一个常驻线程，负责不断检测共享目录是否有新文件进入，如果检测到即会将其加入任务队列，等待上传线程上传  

11. **开启自动上传线程**   
   客户端有一个常驻线程，负责不断检测上传任务队列是否有上传任务，有上传任务则即会将其上传至服务端。 以上传一个文件为例:  
	- 首先构建一个请求包，将请求标志设置为上传文件，将文件名信息、用户信息、文件大小信息以及文件的MD5码填入，然后发送给服务端  
	- 从服务端接收一个响应包，表示该文件上传成功。然后将该文件从本地删除，接着上传下一个文件。

12. **打印功能界面**   
   所有上面的步骤都准备号之后，即认为客户端已准备就绪，随时可以向服务端发起请求，在这里打印服务端支持的所有功能编号以及功能简介，供用户选择  

13. **获取用户输入的功能编号**  
	- **13.1 获取团队文件列表**   
		- 构建一个协议包，将请求标志设置为获取团队文件列表，并将自己的用户名和所属组ID填入，然后将该请求包发送给服务端  
		- 收到一个响应包，然后解析该响应包，获取后面的文件列表数据有多少字节，然后开始接收多少字节的数据，按照约定的文件列表格式将文件路径解析出来后打印  
		
	- **13.2 拉取团队文件**  
		- 首先从标准输入获取要拉取的服务端文件的路径(通过获取文件列表可得)，然后构建一个协议包，将请求标志设置为下载文件，并将文件路径填入，然后将请求包发送给服务端  
		- 收到一个响应包，然后解析该响应包，获取后面的文件数据有多少字节，然后再本地下载目录创建并打开一个同名文件将后面接收到的文件数据写入，当接收完毕后，关闭文件。  
		  
	- **13.3 获取所有组信息**  
		- 首先构建一个请求包，将请求标志设置为获取所有组信息，然后将该协议包发送给服务端  
		- 收到一个响应包，然后解析该响应包，获取后面组信息的数据字节数，然后接收组信息数据，按照组信息解析规则解析后打印  
		  
	- **13.4 创建新的组**  
		- 首先从标准输入获取组信息，包括组名和组简介，组ID是自动获取的不用填写，然后构建请求包，将请求标志设置为创建新组，然后将该请求包发给服务端，再接着将组信息发送给服务端。
		- 从服务端接收一个响应包，表示创建成功。  
		  
	- **13.5 更改所属组**  
		- 首先从标准输入获取更改的组的组ID(可以通过获取所有组信息获得)，然后构建一个请求包，将请求标志设置为更改所属组，然后将新的组ID填入，然后将请求包发给服务端  
		- 从服务端接收以响应包，表示更改成功  
		
	- **13.6 查看所属组的信息**
		- 构建一个请求包，将请求标志设置为获取所属组信息标志，然后发送给服务端  
		- 收到一个响应包  
			- 正确响应包，解析出组信息，然后打印  
			- 错误响应包，解析出错误信息，然后打印